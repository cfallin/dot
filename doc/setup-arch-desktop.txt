- Boot from USB stick of recent Arch Linux image (I used 2015.06.01)
- use fdisk on /dev/sda: remove all partitions, then create:
  - 500M Linux (type 83) for /boot
  - 220G Linux (type 83) for /
  - 3G Linux swap (type 82) for swap
  - (and leave other disks alone)
- Format everything:
  - mkfs.ext2 /dev/sda1
  - mkfs.ext4 /dev/sda2
  - mkswap /dev/sda3
- Mount everything under /mnt
- ensure network connectivity (dhclient enp0s2)
- pacstrap /mnt base
- genfstab -p /mnt >> /mnt/etc/fstab
- arch-chroot /mnt
- In the chroot:
  - set up /etc/hostname and /etc/localtime (symlink to /usr/share/zoneinfo/...)
  - pacman -S grub dosfstools
  - grub-install /dev/sda
  - passwd (set root password)
- leave chroot, umount -R /mnt, reboot, ensure BIOS boots from hard drive

- On next boot:
  - blkid to see UUIDs; add disks at mounts (/home, /big, /backup)
  - get a network connection (dhcpcd en0... if necessary)
  - pacman -S base-devel vim tmux wget bc openssh NetworkManager
  - set up systemd-networkd
  - pacman -S xorg xorg-apps xorg-fonts xf86-video-intel xfce4 slim
  - enable slimd: systemctl enable slimd.service
  - generate locale and set it:
    - edit /etc/locale.gen and uncomment line: "en_US.UTF-8 UTF-8"
    - run locale-gen
    - edit /etc/locale.conf and ensure file is: "LANG=en_US.UTF-8"

- Install packages:

    [enable multilib in pacman.conf]
    [add archlinuxfr repo to pacman.conf -- google yaourt]

    - from pacman:

        sudo git python scons emacs gvim tmux ruby firefox thunderbird pidgin gnome
        rhythmbox gthumb gimp cmake boost jdk7-openjdk clojure strace valgrind
        nmap vlc sshfs encfs clang llvm s3cmd mutt abook irssi sshpass fuse  nasm
        yasm keychain keepassx enscript subversion qt4 qt5 protobuf zlib acpi
        chromium gnupg redshift rsync openvpn ntp gnome-alsamixer xscreensaver
        dnsutils traceroute network-manager-applet rpmextract nodejs docker
        virtualbox virtualbox-host-dkms ghc rust tcl tk qemu yaourt alsa-utils
        lib32-libpulse gdb cups inkscape libreoffice texlive-most ack
        foomatic-db ghostscript gsfonts a2ps npm duplicity evince
        links irssi rubyripper ruby-gtk2 unzip

    - from AUR (yaourt):

        jitsi midori-flash skype

- Enable a few services (pacman -S ntp dkms cronie):

  systemctl enable sshd.service; systemctl start sshd.service
  systemctl enable ntpd.service; systemctl start ntpd.service
  systemctl enable dkms.service; systemctl start dkms.service
  systemctl enable cronie.service; systemctl start cronie.service

- Ensure /etc/cron.daily/backup exists and is executable.

- Setup as network gateway:
  - /etc/systemd/network/inet.network:
        [Match]
        Name=enp4s1

        [Network]
        DNS=8.8.8.8
        DNS=8.8.4.4

        [Network]
        DHCP=ipv4
  - /etc/systemd/network/wired.networK:
        [Match]
        Name=enp2s0
      
        [Network]
        DNS=8.8.8.8
        DNS=8.8.4.4
      
        [Address]
        Address=10.1.1.1/24
    - /etc/sysctl.conf:
        net.ipv4.ip_forward=1
        net.ipv6.conf.default.forwarding=1
        net.ipv6.conf.all.forwarding=1
        net.ipv6.conf.all.accept_ra=0
        net.ipv6.conf.all.accept_ra_defrtr=0
    - Set up iptables NAT:
        $ iptables -t nat -A POSTROUTING -o enp4s1 -j MASQUERADE
        $ iptables-save > /etc/iptables/iptables.conf
        $ systemctl enable iptables
        $ systemctl start iptables
    - /etc/dhcpd.conf:
        option domain-name "i.c1f.net";
        option domain-name-servers 8.8.8.8, 8.8.4.4;

        not authoritative;

        subnet 10.1.1.0 netmask 255.255.255.0 {
            authoritative;
            range 10.1.1.128 10.1.1.192;
            option routers 10.1.1.1;
            default-lease-time 600;
            max-lease-time 7200;
        }
    - set up dhcpd:
        $ systemctl enable dhcpd4
        $ systemctl start dhcpd4

    - set up DHCPv6:
        - install wide-dhcpv6 AUR package
            $ git clone https://aur.archlinux.org/packages/wide-dhcpv6/
            $ cd wide-dhcpv6/
            $ makepkg
            $ pacman -U wide-dhcpv6*.tar.xz
        - /etc/wide-dhcpv6/dhcp6c.conf:
            interface enp4s1 { # external facing interface - WAN
                send ia-pd 0;
            };
    
            id-assoc pd 0 { # prefix delegation request
                prefix-interface enp2s0 {
                    sla-id 1;
                    sla-len 0;
                };
            };
        - enable DHCPv6:
            $ systemctl enable dhcp6c
            $ systemctl start dhcp6c
    - enable radvd:
        - install radvd
        - /etc/radvd.conf:
            interface enp2s0
            {
                    AdvSendAdvert on;
                    IgnoreIfMissing on;
                    MinRtrAdvInterval 3;
                    MaxRtrAdvInterval 10;
                    prefix 2601:547:f00:608e::/64
                    {
                            AdvOnLink on;
                            AdvAutonomous on;
                            AdvRouterAddr on;
                    };
            };
        - systemctl enable radvd; systemctl start radvd




- Create user:

    groupadd -g 1000 cfallin
    useradd -g 1000 -u 1000 cfallin
    passwd cfallin
    edit /etc/group, add cfallin to 'wheel'
    install sudo, edit /etc/sudoers, allow sudo (if desired)

- Samba server/client setup:

  - Set up a Kerberos 5 realm:
    - install krb5 on Fedora desktop. Create kerberos database and user
      principals. Add host principal to /etc/krb5.keytab.
    - install krb5 on laptop. Set default realm. Comment out credentials cache
      filename override -- SMB client wants it in the default location
      /tmp/krb5cc_... . Ensure kinit and GSSAPI-enabled SSH work.
    - Install Samba on desktop. Set realm, security = ADS, kerberos method =
      system keytab, password server = <desktop>, passdb backend = tdbsam
    - Create cifs/<desktop> principal and add to keytab with rc4-hmac:normal
      encryption type
    - Test with smbclient -k -L //<fullname> after kinit.

- Steam setup:

  - pacman -S steam
  - install `steam-fonts` AUR package (git clone, pkgbuild -sri)
  - ln -s /usr/lib32/ld-linux.so.2 /lib/
  - steam
